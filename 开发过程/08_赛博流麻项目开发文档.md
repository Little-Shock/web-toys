# 赛博流麻项目开发文档

## 1. 项目概述

"赛博流麻"是一个基于Web的互动体验项目，旨在创造一种具有液体流动效果、闪片和3D视觉差的"掌上雪花球"动效。用户可以通过摇晃设备或拖动屏幕来与流体互动，产生视觉上令人愉悦的效果，同时提供类似捏泡泡纸的解压体验。

## 2. 产品愿景 & 核心卖点

1. **一晃即闪**：液体 + 闪片流动，堆叠 3D 视觉差，带来"掌上雪花球"动效。
2. **定制门槛低**：换图即可换 IP，无需重开模。
3. **解压属性**：流体缓慢回落，可替代捏泡泡纸的松弛感。
4. **社交货币**：适合在视频、直播中摇晃拍摄，易获得弹幕互动。

## 3. 功能/效果需求拆解

| 模块 | 目标效果 |
|------|----------|
| 视觉主体 | 图像清晰、色彩饱和 |
| 动态流沙 | 8-12 s 完整循环，不滞留气泡 |
| 壳体透光 | 侧面透光率 ≥ 92 % |

## 4. 技术实现方案

### 4.1 核心技术栈

- **Three.js**：用于创建3D场景、相机和渲染器
- **WebGL**：用于高性能图形渲染
- **GLSL着色器**：用于实现流体模拟和视觉效果
- **DeviceOrientation API**：用于检测设备方向变化，实现摇晃交互

### 4.2 主要功能模块

#### 4.2.1 3D场景构建

- 创建透明容器（壳体）
- 实现适当的光照和阴影效果
- 设置相机视角和透视效果

#### 4.2.2 流体模拟

- 实现基于物理的流体动力学模拟
- 确保流体在8-12秒内完成一个完整循环
- 优化流体边界条件，避免气泡滞留

#### 4.2.3 闪片效果

- 在流体中添加闪片粒子
- 实现闪片的随机分布和旋转
- 确保闪片在光照下产生闪烁效果

#### 4.2.4 图像集成

- 允许用户上传自定义图像
- 将图像整合到3D场景中
- 确保图像清晰度和色彩饱和度

#### 4.2.5 交互控制

- 实现设备方向感应，响应摇晃动作
- 提供触摸/鼠标拖动控制选项
- 添加流体动态参数调整界面

### 4.3 性能优化

- 使用WebWorker进行复杂计算，避免主线程阻塞
- 实现自适应渲染分辨率，根据设备性能调整
- 优化着色器代码，减少GPU负载
- 实现资源预加载和渐进式加载

### 4.4 兼容性考虑

- 针对不同浏览器和设备进行测试和优化
- 为不支持WebGL的设备提供降级方案
- 确保在移动设备上的流畅体验

## 5. 项目结构

```
赛博流麻/
├── index.html          # 主HTML文件
├── css/
│   └── style.css       # 样式文件
├── js/
│   ├── main.js         # 主控制脚本
│   ├── FluidSimulator.js  # 流体模拟核心
│   ├── SceneManager.js    # 3D场景管理
│   ├── ParticleSystem.js  # 闪片粒子系统
│   ├── ImageProcessor.js  # 图像处理
│   └── utils/          # 工具函数
│       ├── math.js     # 数学工具
│       ├── shaders.js  # 着色器代码
│       └── controls.js # 交互控制
└── assets/
    ├── textures/       # 纹理资源
    ├── models/         # 3D模型
    └── presets/        # 预设效果
```

## 6. 开发路线图

### 阶段一：基础架构（1-2周）

1. 搭建项目基本结构
2. 实现3D场景和相机设置
3. 创建基本的流体模拟原型
4. 实现设备方向感应基础功能

### 阶段二：核心功能（2-3周）

1. 完善流体模拟算法
2. 实现闪片粒子系统
3. 添加图像上传和处理功能
4. 优化交互控制系统

### 阶段三：视觉效果（1-2周）

1. 改进光照和阴影效果
2. 优化流体和闪片的视觉表现
3. 实现壳体透光效果
4. 添加视觉特效和过渡动画

### 阶段四：性能优化与测试（1-2周）

1. 进行性能分析和优化
2. 实现自适应渲染
3. 跨浏览器和设备测试
4. 修复bug和兼容性问题

### 阶段五：用户体验完善（1周）

1. 添加用户引导和教程
2. 实现预设效果和模板
3. 添加分享功能
4. 最终测试和发布

## 7. 技术挑战与解决方案

### 7.1 流体模拟性能

**挑战**：在移动设备上实现高质量流体模拟非常消耗资源。

**解决方案**：
- 使用简化的流体模型，专注于视觉效果而非物理精确性
- 实现多级细节层次(LOD)，根据设备性能调整模拟精度
- 使用WebWorker进行计算，避免主线程阻塞

### 7.2 3D视觉差效果

**挑战**：创建真实的3D视觉差效果，同时保持良好性能。

**解决方案**：
- 使用分层渲染技术，而非完全3D模拟
- 实现视差映射(Parallax Mapping)着色器
- 优化深度计算，减少不必要的渲染

### 7.3 设备方向感应兼容性

**挑战**：不同设备和浏览器对DeviceOrientation API的支持不一致。

**解决方案**：
- 实现多种交互方式，包括触摸/鼠标拖动作为备选
- 针对不同浏览器实现特定的兼容性代码
- 提供明确的权限请求流程和用户引导

## 8. 测试计划

### 8.1 性能测试

- 在不同性能等级的设备上测试帧率和响应性
- 测量内存使用和CPU/GPU负载
- 长时间运行测试，检查内存泄漏

### 8.2 兼容性测试

- 在主流浏览器上测试(Chrome, Safari, Firefox, Edge)
- 在不同操作系统上测试(iOS, Android, Windows, macOS)
- 在不同屏幕尺寸和分辨率上测试

### 8.3 用户体验测试

- 进行用户测试，收集反馈
- 测试不同光线条件下的视觉效果
- 评估交互的直观性和响应性

## 9. 发布计划

1. 内部测试版(Alpha)：核心团队测试
2. 封闭测试版(Beta)：邀请部分用户测试
3. 公开测试版：收集广泛反馈
4. 正式发布：完整功能上线
5. 后续更新：根据用户反馈持续优化

## 10. 资源需求

### 10.1 开发资源

- 前端开发工程师(熟悉Three.js和WebGL)
- UI/UX设计师
- 测试工程师

### 10.2 设计资源

- 3D建模工具(如Blender)
- 纹理和材质资源
- 参考流体动效素材

### 10.3 测试资源

- 各种性能等级的测试设备
- 自动化测试工具
- 用户测试参与者

## 11. 风险评估

| 风险 | 可能性 | 影响 | 缓解策略 |
|------|--------|------|----------|
| 流体模拟性能不足 | 高 | 高 | 实现多级性能模式，提供简化版本 |
| 设备兼容性问题 | 中 | 高 | 早期进行广泛测试，提供降级方案 |
| 用户交互不直观 | 中 | 中 | 进行用户测试，优化交互设计 |
| 视觉效果不达预期 | 低 | 高 | 与设计团队密切合作，进行迭代优化 |
| 开发时间延误 | 中 | 中 | 设置合理里程碑，保留缓冲时间 |

## 12. 成功指标

- **性能指标**：在中端移动设备上保持30+FPS
- **视觉指标**：流体动效完成一个完整循环的时间为8-12秒
- **用户指标**：平均使用时长>2分钟，分享率>5%
- **技术指标**：兼容90%以上的现代浏览器和设备

## 13. 参考资源

- [WebGL Fluid Simulation](https://github.com/PavelDoGreat/WebGL-Fluid-Simulation)
- [Three.js Documentation](https://threejs.org/docs/)
- [GLSL Shader Tutorial](https://thebookofshaders.com/)
- [Fluid Simulation for Computer Graphics](https://www.cs.ubc.ca/~rbridson/fluidsimulation/)
- [Device Orientation API](https://developer.mozilla.org/en-US/docs/Web/API/DeviceOrientationEvent)
